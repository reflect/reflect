<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdn.reflect.io/latest/reflect.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/js/bootstrap.min.js" integrity="sha384-BLiI7JTZm+JWlgKa0M0kGRpJbF2J8q+qreVrKBC47e3K6BW78kGLrCkeRX6I9RoK" crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.reflect.io/latest/reflect.js" charset="UTF-8"></script>
  </head>
  <body>
    <div id="container">
      <!--
      <nav class="navbar navbar-light bg-faded">
        <ul class="nav navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#">AcmeCorp, Inc.</a>
          </li>
        </ul>
      </nav>
      -->

      <div id="view-container"></div>
    </div>

    <script type="text/javascript">
      console.log("RUNNING");

      function handleUserDataJson(data) {
        console.log(data);

        var usernameParam = {
          field: 'username',
          op: '=',
          value: data.username
        }

        var topicParam = {
          field: 'topic',
          op: '=',
          value: data.topic
        }

        var reflectUi = new ReflectUI(["852550df-d789-4a86-8707-4a92bf9a9348", data.apiToken]);

        reflectUi.withParameters([
          usernameParam,
          topicParam
        ]);

        reflectUi.withFilters([
        ]);

        reflectUi.view(document.getElementById('view-container'), 'newtech', 'newtech-dashboard');
      }

      $.ajax({
        type: 'GET',
        url: '/users',
        dataType: 'json',
        async: true,
        success: handleUserDataJson
      });
    </script>
  </body>
</html>
